<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="content">

    <div class="page-header d-print-none">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">대시보드</h2>
                <div class="text-muted">관리자 홈</div>
            </div>
        </div>
    </div>

    <!-- 상단 KPI 카드 -->
    <div class="row row-deck row-cards mt-3">
        <div class="col-sm-6 col-lg-3">
            <div class="card card-sm">
                <div class="card-body">
                    <div class="subheader">오늘 주문</div>
                    <div class="h1 mb-1" th:text="${dashboard.summary.todayOrderCount}">12</div>
                    <div class="text-muted">
                        전일 대비
                        <span th:text="${dashboard.summary.todayDelta >= 0 ? '+' + dashboard.summary.todayDelta : dashboard.summary.todayDelta}">+3</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-lg-3">
            <div class="card card-sm">
                <div class="card-body">
                    <div class="subheader">주문 완료</div>
                    <div class="h1 mb-1" th:text="${dashboard.summary.orderedCount}">9</div>
                    <div class="text-muted">
                        취소
                        <span th:text="${dashboard.summary.canceledCount}">2</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-lg-3">
            <div class="card card-sm">
                <div class="card-body">
                    <div class="subheader">상품 수</div>
                    <div class="h1 mb-1" th:text="${#numbers.formatInteger(dashboard.summary.productCount, 0, 'COMMA')}">128</div>
                    <div class="text-muted">
                        품절 임박
                        <span th:text="${dashboard.summary.lowStockCount}">3</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-lg-3">
            <div class="card card-sm">
                <div class="card-body">
                    <div class="subheader">회원 수</div>
                    <div class="h1 mb-1" th:text="${#numbers.formatInteger(dashboard.summary.memberCount, 0, 'COMMA')}">1,024</div>
                    <div class="text-muted">
                        이번 주 +<span th:text="${dashboard.summary.weeklyNewMemberCount}">7</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 아래 2컬럼 -->
    <div class="row row-cards mt-3">
        <!-- 최근 주문 -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">최근 주문</h3>
                    <div class="card-actions">
                        <a class="btn btn-sm btn-outline-primary" th:href="@{/admin/orders}">전체 보기</a>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-vcenter card-table">
                        <thead>
                        <tr>
                            <th>주문번호</th>
                            <th>구매자</th>
                            <th>상태</th>
                            <th class="text-end">금액</th>
                            <th class="text-end">주문일</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(dashboard.recentOrders)}">
                            <td colspan="5" class="text-center text-muted">최근 주문이 없습니다.</td>
                        </tr>

                        <tr th:each="order : ${dashboard.recentOrders}">
                            <td>
                                <!-- 네 라우트가 /admin/orders/{orderNo} 아니면 여기만 수정 -->
                                <a th:href="@{|/admin/orders/${order.orderId}|}" th:text="${order.orderNo}">#20260120-0001</a>
                            </td>
                            <td th:text="${order.buyerName}">홍길동</td>
                            <td>
                                <span class="badge"
                                      th:classappend="${
                                        order.orderStatus.name() == 'ORDERED' ? ' bg-blue-lt' :
                                        order.orderStatus.name() == 'CANCELED' ? ' bg-red-lt' :
                                        ' bg-secondary-lt'
                                      }"
                                      th:text="${order.orderStatus.label}">ORDERED</span>
                            </td>
                            <td class="text-end" th:text="${'₩' + #numbers.formatInteger(order.totalAmount, 0, 'COMMA')}">₩52,000</td>
                            <td class="text-end text-muted" th:text="${#temporals.format(order.orderedAt, 'yyyy-MM-dd')}">2026-01-20</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- 빠른 메뉴 + 재고 경고 -->
        <div class="col-lg-4">
            <div class="row row-cards">

                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">빠른 메뉴</h3>
                        </div>
                        <div class="card-body d-grid gap-2">
                            <a class="btn btn-primary btn-lg" th:href="@{/admin/products}">상품 관리</a>
                            <a class="btn btn-outline-primary btn-lg" th:href="@{/admin/orders}">주문 관리</a>
                            <a class="btn btn-outline-primary btn-lg" th:href="@{/admin/members}">회원 관리</a>
                        </div>
                    </div>
                </div>

                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">재고 경고</h3>
                        </div>

                        <div class="list-group list-group-flush">
                            <div class="list-group-item text-muted" th:if="${#lists.isEmpty(dashboard.lowStockItems)}">
                                재고 경고 항목이 없습니다.
                            </div>

                            <a class="list-group-item d-flex justify-content-between align-items-center"
                               th:each="item : ${dashboard.lowStockItems}"
                               th:href="@{|/admin/products/${item.productId}|}">
                                <div>
                                    <div th:text="${item.productName}">상품 A</div>
                                    <div class="text-muted small" th:text="${item.sku}">SKU-001</div>
                                </div>
                                <div class="text-muted">
                                    <span th:text="${item.stockQuantity}">2</span> left
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

            </div><!-- /row -->
        </div>
    </div>

</div>
</body>
</html>