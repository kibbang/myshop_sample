<!-- templates/shop/my/order/list.html -->
<div th:fragment="content">

    <div class="container-xl mt-4">

        <!-- Page header -->
        <div class="page-header mb-3">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <div class="page-pretitle">ë§ˆì´í˜ì´ì§€</div>
                    <h2 class="page-title">ë‚´ ì£¼ë¬¸</h2>
                    <div class="text-muted">ìµœê·¼ 20ê±´ê¹Œì§€ ë³´ì—¬ì¤˜ìš”.</div>
                </div>

                <div class="col-auto ms-auto d-print-none">
                    <a th:href="@{/products}" class="btn btn-outline-primary">
                        ì‡¼í•‘ ê³„ì†í•˜ê¸°
                    </a>
                </div>
            </div>
        </div>

        <!-- Empty state -->
        <div th:if="${orderList == null or #lists.isEmpty(orderList)}" class="card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <span class="avatar avatar-md">ğŸ§¾</span>
                    </div>
                    <div class="flex-fill">
                        <div class="h3 mb-1">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ì–´ìš”</div>
                        <div class="text-muted">ìƒí’ˆì„ ë‘˜ëŸ¬ë³´ê³  ì²« ì£¼ë¬¸ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</div>
                    </div>
                    <div>
                        <a th:href="@{/products}" class="btn btn-primary">ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- List table -->
        <div th:if="${orderList != null and !#lists.isEmpty(orderList)}" class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">ì£¼ë¬¸ ëª©ë¡</h3>
            </div>

            <div class="table-responsive">
                <table class="table table-vcenter card-table">
                    <thead>
                    <tr>
                        <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                        <th>ì£¼ë¬¸ì¼ì‹œ</th>
                        <th>ìƒíƒœ</th>
                        <th>ì¶œê³ </th>
                        <th class="text-end">ê²°ì œê¸ˆì•¡</th>
                        <th class="text-end">ìƒì„¸</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="order : ${orderList}">
                        <!-- ì£¼ë¬¸ë²ˆí˜¸ -->
                        <!-- ê¸°ì¡´: ì£¼ë¬¸ë²ˆí˜¸ ë§í¬ë§Œ ìˆë˜ ë¶€ë¶„ì„ ì•„ë˜ë¡œ êµì²´ -->
                        <td>
                            <div class="d-flex flex-column">

                                <!-- ì£¼ë¬¸ë²ˆí˜¸ + ë³µì‚¬ ë²„íŠ¼ -->
                                <div class="d-flex align-items-center gap-2">
                                    <a th:href="@{|/my/orders/${order.orderNo}|}"
                                       class="text-reset fw-bold"
                                       th:text="${order.orderNo}">
                                        20260209000000000000
                                    </a>

                                    <button type="button"
                                            class="btn btn-sm btn-outline-secondary"
                                            th:attr="data-order-no=${order.orderNo}"
                                            onclick="copyOrderNo(this.dataset.orderNo)">
                                        ì£¼ë¬¸ë²ˆí˜¸ ë³µì‚¬
                                    </button>
                                </div>

                                <!-- ë°›ëŠ”ì‚¬ëŒ -->
                                <div class="text-muted mt-1">
                                    ë°›ëŠ”ì‚¬ëŒ:
                                    <span th:text="${order.receiverName != null ? order.receiverName : '-'}">í™ê¸¸ë™</span>
                                </div>
                            </div>
                        </td>


                        <!-- ì£¼ë¬¸ì¼ì‹œ -->
                        <td class="text-muted"
                            th:text="${#temporals.format(order?.createdAt, 'yyyy-MM-dd HH:mm:ss')}">
                            2026-02-09 18:00
                        </td>

                        <!-- ì£¼ë¬¸ìƒíƒœ ë°°ì§€ -->
                        <td>
              <span class="badge"
                    th:classappend="${order?.orderStatus.name() == 'ORDERED'} ? ' bg-blue-lt'
                                   : (${order?.orderStatus.name() == 'CANCELED'} ? ' bg-red-lt' : ' bg-secondary-lt')"
                    th:text="${order?.orderStatus.label}">
                ORDERED
              </span>
                        </td>

                        <!-- ì¶œê³ ìƒíƒœ ë°°ì§€ -->
                        <td>
              <span class="badge"
                    th:classappend="${order?.releaseStatus != null and order?.releaseStatus.name() == 'READY'} ? ' bg-yellow-lt'
                                   : (${order?.releaseStatus != null and order?.releaseStatus.name() == 'RELEASED'} ? ' bg-green-lt'
                                   : (${order?.releaseStatus != null and order?.releaseStatus.name() == 'CANCELED'} ? ' bg-red-lt'
                                   : ' bg-secondary-lt'))"
                    th:text="${order?.releaseStatus != null ? order?.releaseStatus.label : 'N/A'}">
                READY
              </span>
                        </td>

                        <!-- ê¸ˆì•¡ -->
                        <td class="text-end fw-bold"
                            th:text="${#numbers.formatInteger(order?.totalAmount, 3, 'COMMA')} + 'ì›'">
                            10,000ì›
                        </td>

                        <!-- ìƒì„¸ ë²„íŠ¼ -->
                        <td class="text-end">
                            <a th:href="@{|/my/orders/${order?.orderNo}|}" class="btn btn-sm btn-outline-primary">
                                ìƒì„¸ë³´ê¸°
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="card-footer d-flex justify-content-between">
                <div class="text-muted">
                    ì´ <span th:text="${#lists.size(orderList)}">0</span>ê±´
                </div>
                <div class="text-muted">
                    * ìµœê·¼ 20ê±´ë§Œ í‘œì‹œ
                </div>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div id="copyToast"
         class="toast position-fixed bottom-0 end-0 m-3"
         role="alert" aria-live="assertive" aria-atomic="true"
         style="z-index: 1080; display: none;">
        <div class="toast-header">
            <strong class="me-auto">ì•Œë¦¼</strong>
            <button type="button" class="btn-close" aria-label="Close"
                    onclick="hideCopyToast()"></button>
        </div>
        <div class="toast-body" id="copyToastBody">
            ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <script>
        function showCopyToast(message) {
            const toast = document.getElementById('copyToast');
            const body = document.getElementById('copyToastBody');
            body.textContent = message || 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.';
            toast.style.display = 'block';

            clearTimeout(window.__copyToastTimer);
            window.__copyToastTimer = setTimeout(hideCopyToast, 1600);
        }

        function hideCopyToast() {
            const toast = document.getElementById('copyToast');
            toast.style.display = 'none';
        }

        async function copyOrderNo(orderNo) {
            try {
                await navigator.clipboard.writeText(orderNo);
                showCopyToast('ì£¼ë¬¸ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                showCopyToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
        }
    </script>
</div>
